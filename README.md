# Universal AI Gateway (Deno Edition) - v5.9.19

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸º **Deno Deploy** è®¾è®¡çš„é«˜æ€§èƒ½ã€ä¼ä¸šçº§ AI ç½‘å…³ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼Œæ›´æ˜¯ä¸€ä¸ªé›†æˆäº†**æ™ºèƒ½æµæ§**ã€**å¹¶å‘ç®¡ç†**ã€**æ•…éšœé‡è¯•**å’Œ**èµ„æºä¼˜åŒ–**çš„æµé‡è°ƒåº¦ä¸­å¿ƒã€‚

ç‰¹åˆ«é’ˆå¯¹ **æ²‰æµ¸å¼ç¿»è¯‘**ã€**LangChain**ã€**AutoGPT** ç­‰é«˜å¹¶å‘åœºæ™¯è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæœ€å¤§åŒ–åˆ©ç”¨å…è´¹/ä»˜è´¹ API çš„é¢åº¦ï¼ŒåŒæ—¶æå¤§åœ°é™ä½å°å·é£é™©ã€‚

---

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ (v5.9.19)

### 1. ğŸš€ ä»¤ç‰Œæ¡¶æµæ§ (Token Bucket)
å‘Šåˆ«æ­»æ¿çš„å›ºå®šå»¶è¿Ÿã€‚é‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå…è®¸**çªå‘æµé‡ (Burst)**ã€‚
* **æ•ˆæœ**ï¼šç½‘é¡µç¿»è¯‘æ—¶ï¼Œå‰ 8-10 æ®µç¬é—´å¹¶å‘å‘å‡ºï¼ˆç§’å¼€ï¼‰ï¼Œåç»­è¯·æ±‚å¹³æ»‘é™é€Ÿã€‚æ—¢çˆ½å¿«åˆå®‰å…¨ã€‚

### 2. ğŸ›¡ï¸ åŒé‡ç†”æ–­æœºåˆ¶
* **RPS (Rate Per Second)**: æ§åˆ¶æ¯ç§’è¯·æ±‚æ•°ï¼Œé˜²æ­¢è§¦å‘ä¸Šæ¸¸é€Ÿç‡é™åˆ¶ã€‚
* **MaxConn (æœ€å¤§å¹¶å‘)**: æ§åˆ¶åŒæ—¶åœ¨é€”ï¼ˆIn-flightï¼‰çš„è¯·æ±‚æ•°ã€‚é˜²æ­¢å› ä¸Šæ¸¸å“åº”æ…¢å¯¼è‡´è¿æ¥å †ç§¯ï¼Œè¿›è€Œè§¦å‘ 429 æˆ–å°å·ã€‚

### 3. ğŸ”Œ å®Œç¾ SDK å…¼å®¹
* ä¿®å¤äº†ä¼ ç»Ÿç½‘å…³æ‹¦æˆª `GET` è¯·æ±‚çš„é—®é¢˜ã€‚
* å®Œç¾æ”¯æŒ **OpenAI Python/Node.js SDK**ã€**LangChain** ç­‰åº“çš„åˆå§‹åŒ–æ£€æŸ¥ï¼ˆå¦‚ `GET /v1/models`ï¼‰ã€‚
* æ ¹è·¯å¾„ `/` ä¼ªè£…æˆ Nginx æ¬¢è¿é¡µé¢ï¼Œéšè”½æ€§æ»¡åˆ†ã€‚

### 4. ğŸ§  æ™ºèƒ½åè®®ä¼˜åŒ–
* **Accept-Encoding: identity**: ä¸»åŠ¨è¯·æ±‚ä¸Šæ¸¸è¿”å›æ˜æ–‡ JSONï¼Œå‡å°‘ç½‘å…³è§£å‹å¼€é”€ã€‚
* **Transparent Headers**: æ™ºèƒ½é€ä¼ å“åº”å¤´ï¼Œä¿ç•™ä¸Šæ¸¸çš„ `content-encoding`ï¼Œå½»åº•è§£å†³å®¢æˆ·ç«¯è§£å‹å¤±è´¥å¯¼è‡´çš„æ— é™é‡è¯•é—®é¢˜ã€‚
* **Resource Auto-Release**: åœ¨é‡è¯•å‰æ˜¾å¼é‡Šæ”¾è¿æ¥èµ„æºï¼Œé˜²æ­¢åœ¨é«˜å¹¶å‘ä¸‹ Deno è¿æ¥æ± è€—å°½ã€‚

---

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

æ­¤é¡¹ç›®ä¸“ä¸º **Deno Deploy** æ‰“é€ ã€‚

1.  **åˆ›å»ºé¡¹ç›®**: ç™»å½• [Deno Deploy](https://dash.deno.com/)ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Playground æˆ–ä» GitHub å¯¼å…¥ã€‚
2.  **å¤åˆ¶ä»£ç **: å°† `main.ts` çš„å†…å®¹å®Œæ•´å¤åˆ¶è¿›å»ã€‚
3.  **è®¾ç½®ç¯å¢ƒå˜é‡**: åœ¨ Deno Deploy çš„ Settings -> Environment Variables ä¸­æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
| :--- | :--- | :--- |
| `ACCESS_PASSWORD` | **(å¿…å¡«)** ç½‘å…³è®¿é—®å¯†ç  | `sk-mysecretpassword` |
| `CEREBRAS_API_KEYS` | Cerebras å¯†é’¥ (æ”¯æŒå¤šè¡Œ/é€—å·åˆ†éš”) | `key1,key2,key3` |
| `GROQ_API_KEYS` | Groq å¯†é’¥ | `gsk_1...,gsk_2...` |
| `CLAUDE_API_KEYS` | Anthropic Claude å¯†é’¥ | `sk-ant...` |
| `OPENAI_API_KEYS` | OpenAI å¯†é’¥ | `sk-...` |
| `...` | å…¶ä»–æœåŠ¡çš„ Keyï¼Œå‚è€ƒä»£ç ä¸­çš„ `envKey` | `...` |

4.  **ä¿å­˜å¹¶éƒ¨ç½²**: ç‚¹å‡» **Save & Deploy**ã€‚

---

## âš™ï¸ æœåŠ¡é…ç½®ä¸è°ƒä¼˜

åœ¨ä»£ç é¡¶éƒ¨çš„ `SERVICES_CONFIG` å¸¸é‡ä¸­ï¼Œä½ å¯ä»¥é’ˆå¯¹ä¸åŒæœåŠ¡å•†è¿›è¡Œç²¾ç»†åŒ–è°ƒä¼˜ã€‚ä»¥ä¸‹æ˜¯æ¨èçš„**ç”Ÿäº§ç¯å¢ƒå‚æ•°**ï¼š

### å‚æ•°è¯´æ˜
* **rps**: æ¯ç§’å¹³å‡ç”Ÿæˆçš„ä»¤ç‰Œæ•°ï¼ˆå›è¡€é€Ÿåº¦ï¼‰ã€‚
* **burst**: ä»¤ç‰Œæ¡¶å®¹é‡ï¼ˆå…è®¸ç¬é—´å¹¶å‘çš„æœ€å¤§æ•°é‡ï¼‰ã€‚
* **maxConn**: æœ€å¤§åŒæ—¶å¤„ç†çš„è¿æ¥æ•°ï¼ˆç¡¬æ€§å¹¶å‘çº¢çº¿ï¼‰ã€‚

### æ¨èé…ç½®è¡¨

| æœåŠ¡å•† | RPS | Burst | MaxConn | é€‚ç”¨åœºæ™¯ / å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **Cerebras** | **4** | **8** | **6** | **æ²‰æµ¸å¼ç¿»è¯‘ç¥é€‰**ã€‚4 Key è½®è¯¢é…ç½®ï¼Œé¦–å±ç§’å¼€ï¼Œé˜²å°å·ã€‚ |
| **Groq** | **1** | **3** | **2** | å• Key ä¿å·é…ç½®ã€‚Groq 70b æ¨¡å‹é™é€Ÿä¸¥ï¼Œéœ€ä¿å®ˆã€‚ |
| **Claude** | **2** | **2** | **1** | **æåº¦æ•æ„Ÿ**ã€‚Claude å¯¹å¹¶å‘éå¸¸æ’æ–¥ï¼Œå»ºè®®ä¸²è¡Œã€‚ |
| **DeepSeek** | **10** | **20** | **10** | è€æ“å‹ APIï¼Œå¯ä»¥æ”¾å¼€è·‘ã€‚ |
| **OpenAI** | **10** | **20** | **10** | ä»˜è´¹å·é€šå¸¸é™åˆ¶å®½æ¾ã€‚ |
| **Nvidia** | **3** | **6** | **5** | å…è´¹é¢åº¦è¾ƒé«˜ï¼Œå¯é€‚åº¦å¹¶å‘ã€‚ |

**ä¿®æ”¹ç¤ºä¾‹ï¼š**
```typescript
'/cerebras': {
    // ä½¿ç”¨ Cloudflare Gateway ä½œä¸ºä¸Šæ¸¸ä»¥åˆ©ç”¨ç¼“å­˜
    target: '[https://gateway.ai.cloudflare.com/v1/YOUR_ID/gpt-load/cerebras](https://gateway.ai.cloudflare.com/v1/YOUR_ID/gpt-load/cerebras)',
    envKey: 'CEREBRAS_API_KEYS',
    rps: 4,      // é•¿æœŸé€Ÿåº¦
    burst: 8,    // ç¬é—´çˆ†å‘åŠ›
    maxConn: 6   // å®‰å…¨åˆ¹è½¦
},
ğŸ’» å®¢æˆ·ç«¯ä½¿ç”¨æ–¹æ³•
ç½‘å…³éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šè·å¾—ä¸€ä¸ª URLï¼Œä¾‹å¦‚ https://my-gateway.deno.devã€‚

1. æ²‰æµ¸å¼ç¿»è¯‘ / æµè§ˆå™¨æ’ä»¶
API æ¥å£åœ°å€: https://my-gateway.deno.dev/cerebras/v1/chat/completions

æ³¨æ„ï¼šåŠ ä¸ŠæœåŠ¡å‰ç¼€ï¼Œå¦‚ /cerebras, /groq, /openai ç­‰

API Key: å¡«å†™ä½ åœ¨ç¯å¢ƒå˜é‡ ACCESS_PASSWORD ä¸­è®¾ç½®çš„å¯†ç ã€‚

æ¨¡å‹: å¡«å†™å¯¹åº”æœåŠ¡å•†æ”¯æŒçš„æ¨¡å‹ï¼ˆå¦‚ llama3.1-70bï¼‰ã€‚

2. OpenAI Python SDK
Python

from openai import OpenAI

client = OpenAI(
    # æ³¨æ„åŠ æœåŠ¡å‰ç¼€ï¼Œå¹¶ä»¥ /v1 ç»“å°¾
    base_url="[https://my-gateway.deno.dev/cerebras/v1](https://my-gateway.deno.dev/cerebras/v1)", 
    api_key="sk-mysecretpassword" # å¡«å†™ä½ çš„ç½‘å…³å¯†ç 
)

completion = client.chat.completions.create(
    model="llama3.1-70b",
    messages=[{"role": "user", "content": "Hello!"}]
)
print(completion.choices[0].message.content)
3. LangChain
Python

from langchain_openai import ChatOpenAI

llm = ChatOpenAI(
    openai_api_base="[https://my-gateway.deno.dev/groq/v1](https://my-gateway.deno.dev/groq/v1)",
    openai_api_key="sk-mysecretpassword",
    model_name="llama3-70b-8192"
)
âš ï¸ å¸¸è§é—®é¢˜ (FAQ)
Q: ä¸ºä»€ä¹ˆæ‰“å¼€ç½‘å…³é¦–é¡µæ˜¾ç¤º "Welcome to nginx!"ï¼Ÿ A: è¿™æ˜¯ä¸ºäº†ä¼ªè£…ã€‚ä¸ºäº†é˜²æ­¢è¢«æ¶æ„æ‰«ææˆ–æ¢æµ‹ï¼Œæ ¹è·¯å¾„ / ä¼šæ•…æ„è¿”å› Nginx çš„é»˜è®¤é¡µé¢ã€‚API åŠŸèƒ½éƒ½åœ¨ /v1/... è·¯å¾„ä¸‹æ­£å¸¸å·¥ä½œã€‚

Q: ä¸ºä»€ä¹ˆæˆ‘æœ‰ 10 ä¸ª Keyï¼Œé€Ÿåº¦è¿˜æ˜¯æ²¡èµ·é£ï¼Ÿ A: æ£€æŸ¥ burst å’Œ maxConn å‚æ•°ã€‚å¦‚æœ maxConn è®¾å¾—å¤ªå°ï¼ˆä¾‹å¦‚ 1ï¼‰ï¼Œå³ä½¿ä½ æœ‰ 100 ä¸ª Keyï¼Œç½‘å…³ä¹Ÿåªä¼šåŒä¸€æ—¶é—´å‘ 1 ä¸ªè¯·æ±‚ã€‚Cerebras å»ºè®®è®¾ä¸º 6~8ã€‚

Q: é‡åˆ° 429 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ A: ç½‘å…³å†…ç½®äº†æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶ã€‚å¦‚æœä¾ç„¶ 429ï¼Œè¯´æ˜ä½ çš„ Key æ€»é‡å¤ªå°‘ï¼Œæˆ–è€… rps è®¾å¾—å¤ªé«˜ã€‚è¯·é™ä½ rps æˆ–å¢åŠ  Key çš„æ•°é‡ã€‚

Q: Worker ç‰ˆæœ¬å’Œ Deno ç‰ˆæœ¬é€šç”¨å—ï¼Ÿ A: ä¸é€šç”¨ã€‚æœ¬ä»£ç ä¸“ä¸º Deno Runtime è®¾è®¡ï¼ˆåˆ©ç”¨äº† Deno çš„å†…å­˜é©»ç•™ç‰¹æ€§å®ç°ä»¤ç‰Œæ¡¶ï¼‰ã€‚Cloudflare Workers è¯·ä½¿ç”¨ä¸“é—¨çš„ Failover ç‰ˆæœ¬ã€‚
